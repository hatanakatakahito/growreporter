# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å–å¾—æ©Ÿèƒ½ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

## ğŸ“‹ æ¦‚è¦

ã‚µã‚¤ãƒˆã®ãƒ¡ã‚¿æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜æ–‡ï¼‰ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆPCãƒ»ã‚¹ãƒãƒ›ï¼‰ã‚’è‡ªå‹•å–å¾—ã™ã‚‹Firebase Functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. Firebase Functionsã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```bash
cd functions
```

### 2. ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

`functions/.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```env
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

### 4. Firebase Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd ..
firebase deploy --only functions:fetchSiteMetadata
```

ã¾ãŸã¯ã€ã™ã¹ã¦ã®Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆï¼š

```bash
firebase deploy --only functions
```

---

## âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âœ”  functions[fetchSiteMetadata(asia-northeast1)] Successful create operation.
Function URL (fetchSiteMetadata(asia-northeast1)): https://asia-northeast1-your-project-id.cloudfunctions.net/fetchSiteMetadata
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆ

1. ã‚µã‚¤ãƒˆç™»éŒ²ç”»é¢ï¼ˆSTEP 1ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å¯¾è±¡URLã« `https://dormy-nagoya.com` ãªã©ã‚’å…¥åŠ›
3. ã€Œã‚µã‚¤ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã€ã®ã€Œè‡ªå‹•å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ¡ã‚¿æƒ…å ±ãŒè‡ªå‹•çš„ã«å…¥åŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
5. ã€Œã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ã®ã€Œè‡ªå‹•å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
6. PCã¨ã‚¹ãƒãƒ›ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### 2. Firebase Consoleã§ãƒ­ã‚°ç¢ºèª

1. [Firebase Console](https://console.firebase.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒFunctionsã€â†’ã€Œãƒ­ã‚°ã€ã‚’é¸æŠ
4. `fetchSiteMetadata` ã®ãƒ­ã‚°ã‚’ç¢ºèª

---

## âš™ï¸ é–¢æ•°ã®ä»•æ§˜

### å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```javascript
{
  siteUrl: string,           // å¿…é ˆ: å–å¾—å¯¾è±¡ã®URL
  fetchScreenshots: boolean  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚‚å–å¾—ã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
}
```

### å‡ºåŠ›

```javascript
{
  metaTitle: string,          // ã‚µã‚¤ãƒˆã‚¿ã‚¤ãƒˆãƒ«
  metaDescription: string,    // ã‚µã‚¤ãƒˆèª¬æ˜æ–‡
  pcScreenshotUrl?: string,   // PCã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆURLï¼ˆfetchScreenshots=trueã®å ´åˆï¼‰
  mobileScreenshotUrl?: string // ã‚¹ãƒãƒ›ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆURLï¼ˆfetchScreenshots=trueã®å ´åˆï¼‰
}
```

### ãƒªã‚½ãƒ¼ã‚¹

- **ãƒ¡ãƒ¢ãƒª**: 2GiB
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 60ç§’
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: asia-northeast1ï¼ˆæ±äº¬ï¼‰

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Puppeteer not found"

```bash
cd functions
npm install puppeteer
```

### ã‚¨ãƒ©ãƒ¼: "Permission denied"

Firebase Storageã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /screenshots/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

é‡ã„ã‚µã‚¤ãƒˆã®å ´åˆã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
`functions/src/index.js` ã® `timeoutSeconds` ã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ï¼š

```javascript
export const fetchSiteMetadata = onCall({
  memory: '2GiB',
  timeoutSeconds: 120, // 60ç§’ â†’ 120ç§’ã«å¤‰æ›´
  region: 'asia-northeast1',
  cors: true,
}, fetchSiteMetadataCallable);
```

---

## ğŸ’° ã‚³ã‚¹ãƒˆã«ã¤ã„ã¦

### æ–™é‡‘ã®ç›®å®‰

- **Cloud Functions**: å®Ÿè¡Œæ™‚é–“ã«å¿œã˜ã¦èª²é‡‘
  - ãƒ¡ã‚¿æƒ…å ±ã®ã¿: ç´„5ç§’ Ã— $0.0000025/ç§’ = $0.0000125
  - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå«ã‚€: ç´„15ç§’ Ã— $0.0000025/ç§’ = $0.0000375
- **Cloud Storage**: ç”»åƒä¿å­˜ã«å¿œã˜ã¦èª²é‡‘
  - 1æšã‚ãŸã‚Šç´„100KB Ã— $0.026/GB = $0.0000026

### ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãƒ’ãƒ³ãƒˆ

1. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å¿…è¦ãªæ™‚ã ã‘å–å¾—
2. å–å¾—æ¸ˆã¿ã®ãƒ¡ã‚¿æƒ…å ±ã¯å†åˆ©ç”¨
3. å¤ã„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å®šæœŸçš„ã«å‰Šé™¤

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… Firebase Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
2. âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
3. âœ… Firebase Storageã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®š
4. ğŸ”„ æœ¬ç•ªç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
5. ğŸ‰ å®Œäº†ï¼

---

## ğŸ†˜ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. Firebase Consoleã®ãƒ­ã‚°
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
3. Firebase Storageã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ­ã‚°ã‚’æ·»ãˆã¦ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚



